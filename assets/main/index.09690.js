window.__require=function t(i,e,o){function c(r,n){if(!e[r]){if(!i[r]){var l=r.split("/");if(l=l[l.length-1],!i[l]){var a="function"==typeof __require&&__require;if(!n&&a)return a(l,!0);if(s)return s(l,!0);throw new Error("Cannot find module '"+r+"'")}r=l}var h=e[r]={exports:{}};i[r][0].call(h.exports,function(t){return c(i[r][1][t]||t)},h,h.exports,t,i,e,o)}return e[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<o.length;r++)c(o[r]);return c}({blocks:[function(t,i,e){"use strict";cc._RF.push(i,"0a4b26GU/9HVZMC3b1zyHdb","blocks");var o=cc.Enum({ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,STAR:9}),c=cc.Enum({CLOSED:0,OPEN:1});cc.Class({extends:cc.Component,properties:{picCLOSED:cc.SpriteFrame,picZERO:cc.SpriteFrame,picONE:cc.SpriteFrame,picTWO:cc.SpriteFrame,picTHREE:cc.SpriteFrame,picFOUR:cc.SpriteFrame,picFIVE:cc.SpriteFrame,picSIX:cc.SpriteFrame,picSEVEN:cc.SpriteFrame,picEIGHT:cc.SpriteFrame,picSTAR:cc.SpriteFrame,type:{default:o.ZERO,type:o},state:{default:c.CLOSED,type:c},isBlueStar:!1,X:0,Y:0},showType:function(){if(this.state==c.CLOSED)this.getComponent(cc.Sprite).spriteFrame=this.picCLOSED;else switch(this.type){case o.ZERO:this.getComponent(cc.Sprite).spriteFrame=this.picZERO;break;case o.ONE:this.getComponent(cc.Sprite).spriteFrame=this.picONE;break;case o.TWO:this.getComponent(cc.Sprite).spriteFrame=this.picTWO;break;case o.THREE:this.getComponent(cc.Sprite).spriteFrame=this.picTHREE;break;case o.FOUR:this.getComponent(cc.Sprite).spriteFrame=this.picFOUR;break;case o.FIVE:this.getComponent(cc.Sprite).spriteFrame=this.picFIVE;break;case o.SIX:this.getComponent(cc.Sprite).spriteFrame=this.picSIX;break;case o.SEVEN:this.getComponent(cc.Sprite).spriteFrame=this.picSEVEN;break;case o.EIGHT:this.getComponent(cc.Sprite).spriteFrame=this.picEIGHT;break;case o.STAR:this.getComponent(cc.Sprite).spriteFrame=this.picSTAR}}}),cc._RF.pop()},{}],charPickControl:[function(t,i,e){"use strict";cc._RF.push(i,"1979e44uMxFm7/zGr0LvkFf","charPickControl"),window.Global={currentCharIndex:0,charList:["boy","girl","butterfly","mengmeng"],charList_CN:["\u65c5\u884c\u8005\xb7\u54e5\u54e5","\u65c5\u884c\u8005\xb7\u59b9\u59b9","\u8774\u8776","\u840c\u840c"]},cc.Class({extends:cc.Component,properties:{char_girl:{default:null,type:cc.Node},char_boy:{default:null,type:cc.Node},char_butterfly:{default:null,type:cc.Node},char_mengmeng:{default:null,type:cc.Node},label_charFile:{default:null,type:cc.Label},btn_confirm:{default:null,type:cc.Node},btn_back:{default:null,type:cc.Node},btn_right:{default:null,type:cc.Node},btn_left:{default:null,type:cc.Node},pickAudio:cc.AudioClip},onLoad:function(){this.displayCharAndFile(),this.btn_right.on("touchstart",this.btnRight,this),this.btn_left.on("touchstart",this.btnLeft,this),this.btn_back.on("touchstart",function(){this.playClickAudio(),cc.director.loadScene("cover1")},this),this.btn_confirm.on("touchstart",function(){this.playClickAudio(),cc.director.loadScene("game1")},this)},displayCharAndFile:function(){switch(Global.charList[Global.currentCharIndex]){case"boy":this.char_boy.active=!0,this.char_girl.active=!1,this.char_butterfly.active=!1,this.char_mengmeng.active=!1,this.label_charFile.string="\u65c5\u884c\u8005\xb7\u54e5\u54e5\n\u64c5\u957f\u4f7f\u7528\u4fdd\u62a4\u6280\u80fd\n\u6bcf\u4e09\u4e2a\u56de\u5408\u83b7\u5f97\u6280\u80fd\u5361\u3010\u5b88\u62a4\u4e4b\u76fe\u3011\n\uff08\u4f7f5\xd75\u8303\u56f4\u5185\u7684\u65b9\u5757\u4e0d\u80fd\u88ab\u70b9\u51fb\n\u5bf9\u65b9\u4e24\u6b21\u884c\u52a8\u540e\u89e3\u9664\uff09",this.char_boy.position=cc.v2(0,-110);break;case"girl":this.char_boy.active=!1,this.char_girl.active=!0,this.char_butterfly.active=!1,this.char_mengmeng.active=!1,this.label_charFile.string="\u65c5\u884c\u8005\xb7\u59b9\u59b9\n\u64c5\u957f\u4f7f\u7528\u7834\u574f\u9b54\u6cd5\n\u6bcf\u4e09\u4e2a\u56de\u5408\u83b7\u5f97\u6280\u80fd\u5361\u3010\u706b\u7403\u672f\u3011\n\uff08\u6467\u6bc13\xd73\u8303\u56f4\u5185\u7684\u661f\u661f\uff09",this.char_girl.position=cc.v2(0,-110);break;case"butterfly":this.char_boy.active=!1,this.char_girl.active=!1,this.char_butterfly.active=!0,this.char_mengmeng.active=!1,this.label_charFile.string="\u8774\u8776\n\u53ef\u4ee5\u968f\u65f6\u8ba9\u81ea\u5df1\u6c89\u7761\n\u6bcf\u4e09\u4e2a\u56de\u5408\u83b7\u5f97\u6280\u80fd\u5361\u3010\u5165\u68a6\u3011\n\uff08\u6e05\u7a7a\u5f53\u524d\u56de\u5408\u7684\u884c\u52a8\u6570\uff0c\u4e0b\u56de\u5408\u884c\u52a8\u6570+1\uff09",this.char_butterfly.position=cc.v2(0,-110);break;case"mengmeng":this.char_boy.active=!1,this.char_girl.active=!1,this.char_butterfly.active=!1,this.char_mengmeng.active=!0,this.label_charFile.string="\u840c\u840c\n\u8fd9\u4e2a\u5bb6\u4f19\u770b\u4e0a\u53bb\u61d2\u6d0b\u6d0b\u7684\n\u6ca1\u6709\u7279\u6b8a\u80fd\u529b",this.char_mengmeng.position=cc.v2(0,-110)}},btnRight:function(){this.playClickAudio(),Global.currentCharIndex==Global.charList.length-1?Global.currentCharIndex=0:Global.currentCharIndex+=1,this.displayCharAndFile()},btnLeft:function(){this.playClickAudio(),0==Global.currentCharIndex?Global.currentCharIndex=Global.charList.length-1:Global.currentCharIndex-=1,this.displayCharAndFile()},playClickAudio:function(){cc.audioEngine.playEffect(this.pickAudio,!1)}}),cc._RF.pop()},{}],chars:[function(t,i,e){"use strict";cc._RF.push(i,"6a487eYw59G4a7bDozusdgf","chars"),cc.Class({extends:cc.Component,properties:{picBoy:cc.SpriteFrame,picGirl:cc.SpriteFrame,picButterfly:cc.SpriteFrame,picMengmeng:cc.SpriteFrame},showType:function(t){switch(t){case 0:this.getComponent(cc.Sprite).spriteFrame=this.picBoy;break;case 1:this.getComponent(cc.Sprite).spriteFrame=this.picGirl;break;case 2:this.getComponent(cc.Sprite).spriteFrame=this.picButterfly;break;case 3:this.getComponent(cc.Sprite).spriteFrame=this.picMengmeng}}}),cc._RF.pop()},{}],coverControl:[function(t,i,e){"use strict";cc._RF.push(i,"6beabr3/qVF1Y5V0/dBwtFF","coverControl"),cc.Class({extends:cc.Component,properties:{coverName:"",UI:{default:null,type:cc.Node},btnStart:{default:null,type:cc.Node},btnHelp:{default:null,type:cc.Node},btnSwitch:{default:null,type:cc.Node},switchTo:"",helpWindow:{default:null,type:cc.Node},btnBack:{default:null,type:cc.Node},clickAudio:cc.AudioClip},onLoad:function(){var t=this.helpWindow.position;this.btnHelp.on("touchstart",function(t){this.playClickAudio(),this.helpWindow.position=cc.v2(323,465.4),this.UI.active=!1},this),this.btnBack.on("touchstart",function(i){this.playClickAudio(),this.helpWindow.position=t,this.UI.active=!0},this),this.btnStart.on("touchstart",function(t){this.playClickAudio(),console.log("touch start"),"cover1"==this.coverName&&cc.director.loadScene("pick1")},this)},playClickAudio:function(){cc.audioEngine.playEffect(this.clickAudio,!1)}}),cc._RF.pop()},{}],gameControl:[function(t,i,e){"use strict";cc._RF.push(i,"cc430STWP9F775nAGgci20w","gameControl");var o=cc.Enum({ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,STAR:9}),c=cc.Enum({CLOSED:0,OPEN:1}),s=cc.Enum({NONE:0,SHIELD:1,FIRE:2,SLEEP:3,REBUILD:4});cc.Class({extends:cc.Component,properties:{blockPrefab:cc.Prefab,charPrefab:cc.Prefab,starPrefab:cc.Prefab,skillPrefab:cc.Prefab,animBoom:cc.Prefab,animShield:cc.Prefab,animRebuild:cc.Prefab,animClick:cc.Prefab,scoreAudio:cc.AudioClip,clickAudio:cc.AudioClip,pickSkillAudio:cc.AudioClip,shieldAudio:cc.AudioClip,fireBallAudio:cc.AudioClip,sleepAudio:cc.AudioClip,rebuildAudio:cc.AudioClip,winAudio:cc.AudioClip,btnBack:cc.Node,labelBegin:cc.Label,labelGoal:cc.Label,labelEnd:cc.Label,blockLayout:cc.Node,blockSet:[],myChar:cc.Node,myScore:0,myScoreLabel:cc.Label,myCD:2,myCDLabel:cc.Label,oppCharIndex:0,oppChar:cc.Node,oppScore:0,oppScoreLabel:cc.Label,oppCD:0,oppCDLabel:cc.Label,mySkillBox1:cc.Node,mySkillBox2:cc.Node,mySkillBox3:cc.Node,mySkillArray:[],oppSkillBox1:cc.Node,oppSkillBox2:cc.Node,oppSkillBox3:cc.Node,oppSkillArray:[],activeSkillArray:[],isSleep:!1,oppIsSleep:!1,myPickSkill:{default:s.NONE,type:s},oppPickSkill:{default:s.NONE,type:s},row:0,col:0,totalStarNum:0,goalScore:0,restStarNum:0,isFirst:!0,round:0,myAction:0,oppAction:0,currentAct:0,endGameWindow:cc.Node,endGameLabel:cc.Label,endGameCancel:cc.Node,endGameReplay:cc.Node,charInfoWindow:cc.Node,charInfoWindowCancel:cc.Node,charInfoWindowLabel_1:cc.Label,charInfoWindowLabel_2:cc.Label,skillInfoWindow:cc.Node,skillInfoWindowSprite:cc.Node,skillInfoWindowLabel:cc.Label,skillInfoWindowCancel:cc.Node,ifTouch:!1,touchLastTime:0,tempData:0,tempArray:[]},onLoad:function(){var t=this;this.mySkillArray.push(this.mySkillBox1),this.mySkillArray.push(this.mySkillBox2),this.mySkillArray.push(this.mySkillBox3),this.oppSkillArray.push(this.oppSkillBox1),this.oppSkillArray.push(this.oppSkillBox2),this.oppSkillArray.push(this.oppSkillBox3);for(var i=0;i<this.mySkillArray.length;i++)this.mySkillArray[i].isPick=!1,this.oppSkillArray[i].isPick=!1;this.isSleep=!1,this.oppIsSleep=!1;for(var e=0;e<this.row;e++)for(var o=0;o<this.col;o++){var c=cc.instantiate(this.blockPrefab);c.getComponent("blocks").X=e,c.getComponent("blocks").Y=o,c.on("touchstart",function(i){var e=i.target.getComponent("blocks").X,o=i.target.getComponent("blocks").Y;t.myActionFunction(e,o)}),this.blockLayout.addChild(c),this.blockSet.push(c)}this.initialField(),this.btnBack.on("touchstart",function(){this.playClickAudio(),cc.director.loadScene("pick1")},this),this.endGameCancel.on("touchstart",function(){this.playClickAudio(),t.endGameWindow.active=!1},this),this.endGameReplay.on("touchstart",function(){this.playClickAudio(),cc.director.loadScene("game1")},this),this.myChar.on(cc.Node.EventType.TOUCH_START,function(t){this.ifTouch=!0,this.touchLastTime=0},this),this.myChar.on(cc.Node.EventType.TOUCH_END,function(i){this.playClickAudio(),t.showCharInfoWindow(Global.currentCharIndex)},this),this.oppChar.on(cc.Node.EventType.TOUCH_START,function(t){this.ifTouch=!0,this.touchLastTime=0},this),this.oppChar.on(cc.Node.EventType.TOUCH_END,function(i){this.playClickAudio(),t.showCharInfoWindow(this.oppCharIndex)},this),this.charInfoWindowCancel.on("touchstart",function(i){for(this.playClickAudio();this.tempArray.length;){console.log(this.tempArray),this.tempArray.pop().destroy()}t.charInfoWindow.active=!1,cc.tween(this).delay(.5).call(function(){t.myAction=t.tempData}).start()},this),this.skillInfoWindowCancel.on("touchstart",function(i){this.playClickAudio(),this.skillInfoWindowSprite.removeAllChildren(),t.skillInfoWindow.active=!1,cc.tween(this).delay(.5).call(function(){t.myAction=t.tempData}).start()},this)},showLabelBegin:function(){this.labelBegin.node.position=cc.v2(80,20),this.labelBegin.node.opacity=0;var t=cc.spawn(cc.moveTo(.75,0,20),cc.fadeTo(1,255));t.easing(cc.easeCubicActionOut(3));var i=cc.spawn(cc.moveTo(1,-80,20),cc.fadeTo(1,0));i.easing(cc.easeCubicActionIn(3));var e=cc.sequence(t,i);this.labelBegin.node.runAction(e)},newGame:function(){this.oppCharIndex=Math.floor(Math.random()*Global.charList_CN.length);var t=cc.instantiate(this.charPrefab);t.getComponent("chars").showType(Global.currentCharIndex),this.myChar.addChild(t),t.setPosition(cc.v2(0,0));var i=cc.instantiate(this.charPrefab);i.getComponent("chars").showType(this.oppCharIndex),this.oppChar.addChild(i),i.setPosition(cc.v2(0,0)),this.round=1,this.myAction=1,this.oppAction=1,this.myScore=0,this.myCD=2,this.oppScore=0,this.oppCD=2,this.myPickSkill=s.NONE,this.oppPickSkill=s.NONE,this.restStarNum=this.totalStarNum,Math.random()>=.5?(this.isFirst=!0,this.labelBegin.string="\u6211\u65b9\u5148\u624b"):(this.isFirst=!1,this.labelBegin.string="\u5bf9\u65b9\u5148\u624b",this.scheduleOnce(function(){this.oppActionFunction()},.3)),this.showLabelBegin()},openBlock:function(t,i){var e=t*(this.row-1)+i,s=this.blockSet[e];if(s.getComponent("blocks").state!=c.OPEN)if(1==s.isBlueStar&&this.getBlueStar(s),s.getComponent("blocks").type!=o.ZERO)s.getComponent("blocks").state=c.OPEN,s.getComponent("blocks").showType(),s.getComponent("blocks").type==o.STAR?(this.playScoreAudio(),this.showStar(s)):this.playClickAudio();else{this.playClickAudio();var r=[];for(r.push(s);r.length;){var n=r.pop();1==n.isBlueStar&&n.removeAllChildren(),n.getComponent("blocks").state=c.OPEN,n.getComponent("blocks").showType();for(var l=this.roundBlock(n.getComponent("blocks").X,n.getComponent("blocks").Y),a=0;a<l.length;a++){var h=l[a];h.getComponent("blocks").type>0&&h.getComponent("blocks").type<9?(1==h.isBlueStar&&h.removeAllChildren(),h.getComponent("blocks").state=c.OPEN,h.getComponent("blocks").showType()):h.getComponent("blocks").type==o.ZERO&&r.push(h)}}}},showStar:function(t){var i=cc.instantiate(this.starPrefab);i.getComponent("stars").type=0,i.getComponent("stars").showType(),t.addChild(i),i.setPosition(cc.v2(0,0));var e=cc.instantiate(this.starPrefab);i.getComponent("stars").type=0,i.getComponent("stars").showType(),t.addChild(e),e.setPosition(cc.v2(0,0)),cc.tween(e).to(.5,{opacity:0,scale:2}).start().call(function(){e.destroy()})},roundBlock:function(t,i){for(var e=[],o=t-1;o<=t+1;o++)for(var s=i-1;s<=i+1;s++)if(o>=0&&o<this.row&&s>=0&&s<this.col){var r=o*(this.row-1)+s;this.blockSet[r].getComponent("blocks").state==c.CLOSED&&e.push(this.blockSet[r])}return e},myActionFunction:function(t,i){if(0!=this.myAction&&(this.currentAct=0,1!=this.blockSet[t*(this.row-1)+i].isShield)){if(this.myPickSkill!=s.NONE)this.useSkill(this.myPickSkill,t,i);else{if(this.blockSet[t*(this.row-1)+i].getComponent("blocks").state==c.OPEN)return;if(this.openBlock(t,i),this.myAction--,this.blockSet[t*(this.row-1)+i].getComponent("blocks").type==o.STAR&&(this.myScore++,this.restStarNum--),this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09",this.myScoreLabel.string=this.myScore,this.myScore==this.goalScore)return void this.endGame();if(0==this.restStarNum){if(this.newField(),0!=this.myAction)return;return this.isFirst||this.roundUpdate(),this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09",void this.scheduleOnce(function(){this.oppActionFunction()},1.2)}}0==this.myAction&&(this.isFirst||this.roundUpdate(),this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09",this.scheduleOnce(function(){this.oppActionFunction()},.3))}},oppActionFunction:function(){if(console.log("oppAction:"+this.oppAction),0!=this.oppAction){this.currentAct=1;for(var t=this.newMat(),i=0;i<this.row;i++)for(var e=0;e<this.col;e++){var s=i*(this.row-1)+e;this.blockSet[s].getComponent("blocks").state==c.CLOSED?t[i][e]=-1:t[i][e]=this.blockSet[s].getComponent("blocks").type}for(var r=this.newMat(),n=0;n<this.row;n++)for(var l=0;l<this.col;l++){s=n*(this.row-1)+l;this.blockSet[s].getComponent("blocks").state==c.CLOSED?r[n][l]=-1:r[n][l]=-2}for(var a=0;a<3;a++){for(var h=0;h<this.row;h++)for(var p=0;p<this.col;p++)if(t[h][p]>0&&t[h][p]<9){for(var d=0,u=0,k=h-1;k<=h+1;k++)for(var S=p-1;S<=p+1;S++)k>=0&&k<this.row&&S>=0&&S<this.col&&(9==t[k][S]&&d++,-1==t[k][S]&&1==r[k][S]&&u++);if(t[h][p]==d+u)for(var m=h-1;m<=h+1;m++)for(var f=p-1;f<=p+1;f++)m>=0&&m<this.row&&f>=0&&f<this.col&&-1==t[m][f]&&1!=r[m][f]&&0!=r[m][f]&&(r[m][f]=0)}for(var b=0;b<this.row;b++)for(var y=0;y<this.col;y++)if(t[b][y]>0&&t[b][y]<9){d=0,u=0;for(var g=0,C=0,v=[],w=b-1;w<=b+1;w++)for(var A=y-1;A<=y+1;A++)w>=0&&w<this.row&A>=0&&A<this.col&&(9==t[w][A]&&d++,-1==t[w][A]&&1==r[w][A]&&u++,-1==t[w][A]&&0==r[w][A]&&C++,-1==t[w][A]&&g++,-1==t[w][A]&&1!=r[w][A]&&0!=r[w][A]&&v.push([w,A]));for(var E=(t[b][y]-d-u)/(g-C-u);v.length;){var F=(R=v.pop())[0],N=R[1];r[F][N]=E}}}u=0;for(var T=[],I=0;I<this.row;I++)for(var P=0;P<this.col;P++)-1==t[I][P]&&(1==r[I][P]&&u++,-1==r[I][P]&&T.push([I,P]));for(var L=(this.restStarNum-u)/T.length;T.length;){var R;F=(R=T.pop())[0],N=R[1];r[F][N]=L}for(var _=0,O=[],W=0;W<this.row;W++)for(var B=0;B<this.col;B++)r[W][B]>_&&0==this.blockSet[W*(this.row-1)+B].isShield&&(_=r[W][B]);for(var G=0;G<this.row;G++)for(var x=0;x<this.col;x++)r[G][x]==_&&0==this.blockSet[G*(this.row-1)+x].isShield&&O.push([G,x]);var D=O[Math.floor(Math.random()*O.length)],H=D[0],M=D[1];if(null!=D&&(this.showClick(H,M),this.openBlock(H,M),console.log("opponent moved"),this.oppAction--,this.blockSet[H*(this.row-1)+M].getComponent("blocks").type==o.STAR&&(this.oppScore++,this.restStarNum--),this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09",this.oppScoreLabel.string=this.oppScore),this.oppScore!=this.goalScore){0==this.restStarNum&&this.newField();for(var U=0;U<this.activeSkillArray.length;U++){var X=this.activeSkillArray[U];if(0==X.user&&(X.last--,0==X.last)){for(var V=X.X,Z=X.Y,q=V-2;q<=V+2;q++)for(var Y=Z-2;Y<=Z+2;Y++)q>=0&&q<this.row&&Y>=0&&Y<this.col&&(this.blockSet[q*(this.row-1)+Y].isShield=!1,this.blockSet[q*(this.row-1)+Y].opacity=240);X.destroy()}}this.isFirst&&this.roundUpdate(),this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09"}else this.endGame()}},newField:function(){console.log("create new field");for(var t=this;this.activeSkillArray.length;){this.activeSkillArray.pop().destroy()}var i=0,e=setInterval(function(){if(0==i)for(var s=0;s<t.blockSet.length;s++)t.blockSet[s].getComponent("blocks").state=c.OPEN;if(i>18)return t.initialField(),void clearInterval(e);for(var r=0;r<t.row;r++)for(var n=0;n<t.col;n++)n<=i&&(n!=r-6+i&&n!=7-r+i||(t.blockSet[r*(t.row-1)+n].removeAllChildren(),t.blockSet[r*(t.row-1)+n].getComponent("blocks").type=o.STAR,t.blockSet[r*(t.row-1)+n].getComponent("blocks").state=c.OPEN,t.blockSet[r*(t.row-1)+n].getComponent("blocks").showType(),t.blockSet[r*(t.row-1)+n].opacity=240),n<r-6+i&&n<7-r+i&&(t.blockSet[r*(t.row-1)+n].getComponent("blocks").state=c.CLOSED,t.blockSet[r*(t.row-1)+n].getComponent("blocks").showType(),t.blockSet[r*(t.row-1)+n].getComponent("blocks").state=c.OPEN));i++},50)},newMat:function(){for(var t=new Array,i=0;i<this.row;i++){t.push(new Array);for(var e=0;e<this.col;e++)t[i].push(0)}return t},endGame:function(){this.endGameWindow.active=!0,this.myAction=0,this.oppAction=0,this.myScore==this.goalScore?(this.playWinAudio(),this.endGameLabel.string="\u4f60\u80dc\u5229\u4e86"):this.endGameLabel.string="\u4f60\u8d25\u4e86",this.endGameWindow.setPosition(cc.v2(0,10)),this.endGameWindow.opacity=130,this.endGameWindow.scale=.3,cc.tween(this.endGameWindow).to(.1,{opacity:255,scale:1}).start()},initialField:function(){for(var t=0;t<this.blockSet.length;t++)this.blockSet[t].getComponent("blocks").type=o.ZERO,this.blockSet[t].getComponent("blocks").state=c.CLOSED,this.blockSet[t].getComponent("blocks").showType(),this.blockSet[t].removeAllChildren(),this.blockSet[t].isShield=!1,this.blockSet[t].opacity=240;for(var i=[],e=0;e<this.blockSet.length;e++)i[e]=e;for(var s=0;s<this.totalStarNum;s++){var r=Math.floor(Math.random()*i.length);this.blockSet[i[r]].getComponent("blocks").type=o.STAR,i.splice(r,1)}for(var n=0;n<this.row;n++)for(var l=0;l<this.col;l++)if(this.blockSet[n*(this.row-1)+l].getComponent("blocks").type==o.ZERO){for(var a=0,h=this.roundBlock(n,l),p=0;p<h.length;p++)h[p].getComponent("blocks").type==o.STAR&&a++;this.blockSet[n*(this.row-1)+l].getComponent("blocks").type=a}this.restStarNum=this.totalStarNum,this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09"},showCharInfoWindow:function(t){if(this.ifTouch=!1,this.touchLastTime>=30){this.tempData=this.myAction,this.myAction=0,this.charInfoWindow.active=!0,this.charInfoWindow.setPosition(cc.v2(0,20));var i=cc.instantiate(this.charPrefab),e=cc.instantiate(this.skillPrefab);switch(this.charInfoWindow.addChild(i),this.charInfoWindow.addChild(e),i.getComponent("chars").showType(t),t){case 0:this.charInfoWindowLabel_1.string="\u65c5\u884c\u8005\xb7\u54e5\u54e5\uff1a\u6bcf\u4e09\u56de\u5408\u83b7\u5f97\u6280\u80fd\u5361\u3010\u5b88\u62a4\u4e4b\u76fe\u3011",this.charInfoWindowLabel_2.string="\u3010\u5b88\u62a4\u4e4b\u76fe\u3011\u4f7f\u5f975\xd75\u8303\u56f4\u5185\u7684\u65b9\u5757\u4e0d\u80fd\u88ab\u70b9\u51fb\uff0c\u5bf9\u65b9\u884c\u52a8\u4e24\u6b21\u540e\u89e3\u9664";var o=1;break;case 1:this.charInfoWindowLabel_1.string="\u65c5\u884c\u8005\xb7\u59b9\u59b9\uff1a\u6bcf\u4e09\u56de\u5408\u83b7\u5f97\u6280\u80fd\u5361\u3010\u706b\u7403\u672f\u3011",this.charInfoWindowLabel_2.string="\u3010\u706b\u7403\u672f\u3011\u6467\u6bc13\xd73\u8303\u56f4\u5185\u7684\u661f\u661f";o=3;break;case 2:this.charInfoWindowLabel_1.string="\u8774\u8776\uff1a\u6bcf\u4e09\u56de\u5408\u83b7\u5f97\u6280\u80fd\u5361\u3010\u5165\u68a6\u3011",this.charInfoWindowLabel_2.string="\u3010\u5165\u68a6\u3011\u6e05\u7a7a\u5f53\u524d\u56de\u5408\u81ea\u8eab\u7684\u884c\u52a8\u6570\uff0c\u4e0b\u56de\u5408\u81ea\u8eab\u884c\u52a8\u6570+1";o=5;break;case 3:this.charInfoWindowLabel_1.string="\u840c\u840c\uff1a\u6ca1\u6709\u7279\u6b8a\u80fd\u529b",this.charInfoWindowLabel_2.string="\u3010\u8111\u888b\u7a7a\u7a7a\u3011\u867d\u7136\u6211\u5565\u4e5f\u4e0d\u4f1a\uff0c\u4f46\u4f60\u4e5f\u4e0d\u4e00\u5b9a\u80fd\u8d62\u6211";o=0}e.getComponent("skills").showType(o),i.scale=.8,i.setPosition(cc.v2(-145,85)),e.setPosition(cc.v2(-145,0)),this.tempArray.push(i),this.tempArray.push(e),this.charInfoWindow.opacity=130,this.charInfoWindow.scale=.3,cc.tween(this.charInfoWindow).to(.1,{opacity:255,scale:1}).start()}this.touchLastTime=0},registerShowSkillInfoWindow:function(t){var i=this;t.on(cc.Node.EventType.TOUCH_START,function(t){this.ifTouch=!0,this.touchLastTime=0},this),t.on(cc.Node.EventType.TOUCH_END,function(e){i.showSkillInfoWindow(t.getComponent("skills").type)},this)},showSkillInfoWindow:function(t){if(this.playClickAudio(),this.ifTouch=!1,this.touchLastTime>=30){this.tempData=this.myAction,this.myAction=0,this.skillInfoWindow.active=!0,this.skillInfoWindow.setPosition(cc.v2(0,0));var i=cc.instantiate(this.skillPrefab);switch(i.scale=.5,i.getComponent("skills").showType(2*t-1),console.log(i.getComponent("skills").type),this.skillInfoWindowSprite.addChild(i),i.setPosition(cc.v2(0,0)),this.skillInfoWindow.opacity=130,this.skillInfoWindow.scale=.3,cc.tween(this.skillInfoWindow).to(.1,{opacity:255,scale:1}).start(),t){case 1:this.skillInfoWindowLabel.string="\u3010\u5b88\u62a4\u4e4b\u76fe\u3011\u4f7f\u5f975\xd75\u8303\u56f4\u5185\u7684\u65b9\u5757\u4e0d\u80fd\u88ab\u70b9\u51fb\uff0c\u5bf9\u65b9\u884c\u52a8\u4e24\u6b21\u540e\u89e3\u9664";break;case 2:this.skillInfoWindowLabel.string="\u3010\u706b\u7403\u672f\u3011\u6467\u6bc13\xd73\u8303\u56f4\u5185\u7684\u661f\u661f";break;case 3:this.skillInfoWindowLabel.string="\u3010\u5165\u68a6\u3011\u6e05\u7a7a\u5f53\u524d\u56de\u5408\u81ea\u8eab\u7684\u884c\u52a8\u6570\uff0c\u4e0b\u56de\u5408\u81ea\u8eab\u884c\u52a8\u6570+1";break;case 4:this.skillInfoWindowLabel.string="\u3010\u661f\u7a7a\u91cd\u7ec4\u3011\u4fdd\u6301\u5269\u4f59\u661f\u661f\u6570\u4e0d\u53d8\uff0c\u91cd\u65b0\u6392\u5217\u6240\u6709\u65b9\u5757"}}},addBlueStar:function(){for(var t=[],i=0;i<this.blockSet.length;i++)this.blockSet[i].getComponent("blocks").state==c.CLOSED&&t.push(i);for(var e=0;e<2;e++){var o=Math.floor(Math.random()*t.length),s=t[o],r=cc.instantiate(this.starPrefab);this.blockSet[s].addChild(r),this.blockSet[s].isBlueStar=!0,r.getComponent("stars").type=1,r.getComponent("stars").showType(),r.setPosition(cc.v2(0,0)),cc.tween(r).to(.2,{angle:-15}).to(.4,{angle:15}).to(.2,{angle:0}).start(),t.splice(o,1)}},roundUpdate:function(){var t=this;if(this.round++,this.myAction++,this.oppAction++,this.myCD--,this.oppCD--,1==this.isSleep&&(this.myAction++,this.isSleep=!1),1==this.oppIsSleep&&(this.oppAction++,this.oppIsSleep=!1),this.myCDLabel.string=this.myCD,this.oppCDLabel.string=this.oppCD,this.round%5==0&&this.addBlueStar(),0==this.myCD){for(var i=0;i<this.mySkillArray.length;i++)if(0==this.mySkillArray[i].children.length){var e=cc.instantiate(this.skillPrefab);switch(this.mySkillArray[i].addChild(e),e.setPosition(cc.v2(0,0)),Global.currentCharIndex){case 0:e.getComponent("skills").showType(1),e.getComponent("skills").type=s.SHIELD;break;case 1:e.getComponent("skills").showType(3),e.getComponent("skills").type=s.FIRE;break;case 2:e.getComponent("skills").showType(5),e.getComponent("skills").type=s.SLEEP;break;case 3:e.destroy()}e.on("touchstart",function(i){t.pickSkill(i)},this),this.registerShowSkillInfoWindow(e);break}this.myCD=4}if(0==this.oppCD){for(var o=0;o<this.oppSkillArray.length;o++)if(0==this.oppSkillArray[o].children.length){var c=cc.instantiate(this.skillPrefab);switch(this.oppSkillArray[o].addChild(c),c.setPosition(cc.v2(0,0)),this.oppCharIndex){case 0:c.getComponent("skills").showType(1),c.getComponent("skills").type=s.SHIELD;break;case 1:c.getComponent("skills").showType(3),c.getComponent("skills").type=s.FIRE;break;case 2:c.getComponent("skills").showType(5),c.getComponent("skills").type=s.SLEEP;break;case 3:c.destroy()}this.registerShowSkillInfoWindow(c);break}this.oppCD=4}},getBlueStar:function(t){var i=this;if(t.removeAllChildren(),0!=this.currentAct){if(1!=this.currentAct);else for(var e=0;e<this.oppSkillArray.length;e++)if(0==this.oppSkillArray[e].children.length){var o=cc.instantiate(this.skillPrefab);this.oppSkillArray[e].addChild(o),o.setPosition(cc.v2(0,0));var c=Math.floor(4*Math.random()+1);o.getComponent("skills").showType(2*c-1),this.registerShowSkillInfoWindow(o);break}}else for(var s=0;s<this.mySkillArray.length;s++)if(0==this.mySkillArray[s].children.length){var r=cc.instantiate(this.skillPrefab);this.mySkillArray[s].addChild(r),r.setPosition(cc.v2(0,0));var n=Math.floor(4*Math.random()+1);r.getComponent("skills").type=n,r.getComponent("skills").showType(2*n-1),r.on("touchstart",function(t){i.pickSkill(t)},this),this.registerShowSkillInfoWindow(r);break}},pickSkill:function(t){this.playSkillPickAudio();for(var i=t.target,e=i.parent,o=0;o<this.mySkillArray.length;o++){if(0!=this.mySkillArray[o].children.length&&e!=this.mySkillArray[o]){var c=this.mySkillArray[o].children[0],r=c.getComponent("skills").type;c.getComponent("skills").showType(2*r-1)}this.mySkillArray[o]!=e&&(this.mySkillArray[o].isPick=!1)}i.getComponent("skills").showType(2*i.getComponent("skills").type),this.myPickSkill=i.getComponent("skills").type,1==e.isPick?(i.getComponent("skills").showType(2*i.getComponent("skills").type-1),this.myPickSkill=s.NONE,e.isPick=!1):e.isPick=!0,console.log("myPickSkill: "+this.myPickSkill),console.log("isPick: "+[this.mySkillBox1.isPick,this.mySkillBox2.isPick,this.mySkillBox3.isPick])},useSkill:function(t,i,e){switch(t){case s.SHIELD:console.log("using skill: Shield"),this.useSkillShield(i,e);break;case s.FIRE:console.log("using skill: Fire"),this.useSkillFire(i,e),this.labelGoal.string="\uff08\u56de\u5408\u6570\uff1a"+this.round+"\uff09\uff08\u76ee\u6807\uff1a"+this.goalScore+"\uff09\uff08\u5269\u4f59\uff1a"+this.restStarNum+"\uff09";break;case s.SLEEP:console.log("using skill: Sleep"),this.useSkillSleep();break;case s.REBUILD:console.log("using skill: Rebuild"),this.useSkillRebuld()}if(0==this.currentAct){for(var o=0;o<this.mySkillArray.length;o++)if(1==this.mySkillArray[o].isPick){console.log("clear mySkillBox: "+(o+1)),this.mySkillArray[o].isPick,this.mySkillArray[o].removeAllChildren(),this.myPickSkill=s.NONE;break}}else for(var c=0;c<this.oppSkillArray.length;c++)if(1==this.oppSkillArray[c].isPick){this.oppSkillArray[c].isPick,this.oppSkillArray[c].removeAllChildren(),this.oppPickSkill=s.NONE;break}},useSkillShield:function(t,i){var e=this.blockSet[t*(this.row-1)+i],o=cc.instantiate(this.animShield);o.X=t,o.Y=i;var c=e.position,s=e.parent.parent.convertToWorldSpaceAR(c);e.parent.parent.addChild(o);var r=e.parent.parent.convertToNodeSpaceAR(s);o.setPosition(r),this.playSheildAudio();for(var n=t-2;n<=t+2;n++)for(var l=i-2;l<=i+2;l++)n>=0&&n<this.row&&l>=0&&l<this.col&&(this.blockSet[n*(this.row-1)+l].isShield=!0,this.blockSet[n*(this.row-1)+l].opacity=160);o.user=this.currentAct,o.last=2,this.activeSkillArray.push(o)},useSkillFire:function(t,i){var e=this.blockSet[t*(this.row-1)+i];this.playFireBallAudio();var s=cc.instantiate(this.animBoom),r=e.position,n=e.parent.parent.convertToWorldSpaceAR(r);e.parent.parent.addChild(s);var l=e.parent.parent.convertToNodeSpaceAR(n);s.setPosition(l),cc.tween(s).delay(.5).call(function(){s.destroy()}).start();for(var a=t-1;a<=t+1;a++)for(var h=i-1;h<=i+1;h++)if(a>=0&&a<=this.row&&h>=0&&h<=this.col){var p=this.blockSet[a*(this.row-1)+h];if(1==p.isBlueStar&&p.removeAllChildren(),p.getComponent("blocks").type==o.STAR&&p.getComponent("blocks").state==c.CLOSED){var d=cc.instantiate(this.starPrefab);d.getComponent("stars").type=2,d.getComponent("stars").showType(),p.addChild(d),d.setPosition(cc.v2(0,0)),p.getComponent("blocks").state=c.OPEN,this.restStarNum--}}0==this.restStarNum&&this.newField()},useSkillSleep:function(){this.playSleepAudio(),0==this.currentAct&&(this.myAction=0,this.isSleep=!0,console.log(this.myAction))},useSkillRebuld:function(){for(var t=this;this.activeSkillArray.length;){this.activeSkillArray.pop().destroy()}this.playRebuildAudio();var i=cc.instantiate(this.animRebuild);this.blockSet[0].parent.parent.addChild(i),i.setPosition(cc.v2(0,50)),cc.tween(i).delay(1.5).call(function(){i.destroy()}).start();var e=0,s=setInterval(function(){if(0==e)for(var i=0;i<t.blockSet.length;i++)t.blockSet[i].getComponent("blocks").state=c.OPEN;if(e>18)return t.rebuildField(),void clearInterval(s);for(var r=0;r<t.row;r++)for(var n=0;n<t.col;n++)n<=e&&(n!=r-6+e&&n!=7-r+e||(t.blockSet[r*(t.row-1)+n].removeAllChildren(),t.blockSet[r*(t.row-1)+n].getComponent("blocks").type=o.STAR,t.blockSet[r*(t.row-1)+n].getComponent("blocks").state=c.OPEN,t.blockSet[r*(t.row-1)+n].getComponent("blocks").showType(),t.blockSet[r*(t.row-1)+n].opacity=240),n<r-6+e&&n<7-r+e&&(t.blockSet[r*(t.row-1)+n].getComponent("blocks").state=c.CLOSED,t.blockSet[r*(t.row-1)+n].getComponent("blocks").showType(),t.blockSet[r*(t.row-1)+n].getComponent("blocks").state=c.OPEN));e++},50)},rebuildField:function(){for(var t=0;t<this.blockSet.length;t++)this.blockSet[t].getComponent("blocks").type=o.ZERO,this.blockSet[t].getComponent("blocks").state=c.CLOSED,this.blockSet[t].getComponent("blocks").showType(),this.blockSet[t].removeAllChildren(),this.blockSet[t].isShield=!1,this.blockSet[t].opacity=240;for(var i=[],e=0;e<this.blockSet.length;e++)i[e]=e;for(var s=0;s<this.restStarNum;s++){var r=Math.floor(Math.random()*i.length);this.blockSet[i[r]].getComponent("blocks").type=o.STAR,i.splice(r,1)}for(var n=0;n<this.row;n++)for(var l=0;l<this.col;l++)if(this.blockSet[n*(this.row-1)+l].getComponent("blocks").type==o.ZERO){for(var a=0,h=this.roundBlock(n,l),p=0;p<h.length;p++)h[p].getComponent("blocks").type==o.STAR&&a++;this.blockSet[n*(this.row-1)+l].getComponent("blocks").type=a}},showClick:function(t,i){var e=cc.instantiate(this.animClick),o=this.blockSet[t*(this.row-1)+i],c=o.position,s=o.parent.parent.convertToWorldSpaceAR(c);o.parent.parent.addChild(e);var r=o.parent.parent.convertToNodeSpaceAR(s);console.log(r),e.setPosition(r),cc.tween(e).delay(.35).call(function(){e.destroy()}).start()},playScoreAudio:function(){cc.audioEngine.playEffect(this.scoreAudio,!1)},playClickAudio:function(){cc.audioEngine.playEffect(this.clickAudio,!1)},playSkillPickAudio:function(){cc.audioEngine.playEffect(this.pickSkillAudio,!1)},playSheildAudio:function(){cc.audioEngine.playEffect(this.shieldAudio,!1)},playFireBallAudio:function(){cc.audioEngine.playEffect(this.fireBallAudio,!1)},playSleepAudio:function(){cc.audioEngine.playEffect(this.sleepAudio,!1)},playRebuildAudio:function(){cc.audioEngine.playEffect(this.rebuildAudio,!1)},playWinAudio:function(){cc.audioEngine.playEffect(this.winAudio,!1)},start:function(){this.newGame()},update:function(){this.ifTouch&&this.touchLastTime++}}),cc._RF.pop()},{}],hover:[function(t,i,e){"use strict";cc._RF.push(i,"2c084eIjX1FJKquCfcUxVp3","hover"),cc.Class({extends:cc.Component,properties:{scaleTo:0,opacityTo:0},onLoad:function(){var t=this.node.scale,i=this.node.opacity;this.node.on("mouseenter",function(t){this.node.scale=this.scaleTo,this.node.opacity=this.opacityTo},this),this.node.on("mouseleave",function(e){this.node.scale=t,this.node.opacity=i},this)}}),cc._RF.pop()},{}],pictureScroll:[function(t,i,e){"use strict";cc._RF.push(i,"b29dcj3VdBMKLQ2Wn7M4TwQ","pictureScroll"),cc.Class({extends:cc.Component,properties:{scrollSpeed:0,pictureWidth:0,pictureX0:0,scaleX:0},onLoad:function(){this.pictureWidth=this.node.width,this.pictureX0=this.node.x,this.scaleX=this.node.scaleX},update:function(t){this.node.x>=this.pictureX0+this.scaleX*this.pictureWidth/2&&(this.node.x=this.pictureX0),this.node.x+=this.scrollSpeed}}),cc._RF.pop()},{}],skills:[function(t,i,e){"use strict";cc._RF.push(i,"043c10gJiFNAIn+m1QWHeGN","skills");var o=cc.Enum({NONE:0,SHIELD:1,FIRE:2,SLEEP:3,REBUILD:4});cc.Class({extends:cc.Component,properties:{picNone:cc.SpriteFrame,picShield:cc.SpriteFrame,picShieldPicked:cc.SpriteFrame,picFire:cc.SpriteFrame,picFirePicked:cc.SpriteFrame,picSleep:cc.SpriteFrame,picSleepPicked:cc.SpriteFrame,picRebuild:cc.SpriteFrame,picRebuildPicked:cc.SpriteFrame,type:{default:o.SHIELD,type:o}},showType:function(t){switch(t){case 0:this.getComponent(cc.Sprite).spriteFrame=this.picNone;break;case 1:this.getComponent(cc.Sprite).spriteFrame=this.picShield;break;case 2:this.getComponent(cc.Sprite).spriteFrame=this.picShieldPicked;break;case 3:this.getComponent(cc.Sprite).spriteFrame=this.picFire;break;case 4:this.getComponent(cc.Sprite).spriteFrame=this.picFirePicked;break;case 5:this.getComponent(cc.Sprite).spriteFrame=this.picSleep;break;case 6:this.getComponent(cc.Sprite).spriteFrame=this.picSleepPicked;break;case 7:this.getComponent(cc.Sprite).spriteFrame=this.picRebuild;break;case 8:this.getComponent(cc.Sprite).spriteFrame=this.picRebuildPicked}}}),cc._RF.pop()},{}],stars:[function(t,i,e){"use strict";cc._RF.push(i,"e1b602uiC5ENp4doKHmDfOb","stars"),cc.Class({extends:cc.Component,properties:{picStar:cc.SpriteFrame,picStarBlue:cc.SpriteFrame,picStarBlack:cc.SpriteFrame,type:0},showType:function(){switch(this.type){case 0:this.getComponent(cc.Sprite).spriteFrame=this.picStar;break;case 1:this.getComponent(cc.Sprite).spriteFrame=this.picStarBlue;break;case 2:this.getComponent(cc.Sprite).spriteFrame=this.picStarBlack}}}),cc._RF.pop()},{}]},{},["blocks","charPickControl","chars","coverControl","gameControl","hover","pictureScroll","skills","stars"]);